=========================================================
ПРОСТОЙ SPRING BOOT БЛОКЧЕЙН ДЛЯ ЖКХ ПЛАТЕЖЕЙ
=========================================================

СОДЕРЖАНИЕ:
1. Описание Проекта
2. Зачем Блокчейн в контексте ЖКХ?
3. Основные Возможности
4. Технологии и Стек
5. Структура Проекта
6. Начало Работы
7. API Эндпоинты
8. Пошаговое Использование

---

1. ОПИСАНИЕ ПРОЕКТА
------------------
Этот проект представляет собой упрощенную демонстрацию использования принципов
блокчейна для отслеживания платежей за жилищно-коммунальные услуги (ЖКХ). Он
моделирует базовую логику добавления платежей, формирования блоков и их
связывания в неизменяемую цепочку, обеспечивая прозрачность и защиту от
подделок данных.

Важно: Это не полноценный блокчейн! Проект сосредоточен на демонстрации
структуры данных блокчейна и концепций неизменяемости и прозрачности.
Здесь нет консенсусных механизмов (Proof-of-Work/Stake), децентрализации,
P2P-сети или криптовалюты. Все данные хранятся в памяти приложения и
теряются при его перезапуске.

---

2. ЗАЧЕМ БЛОКЧЕЙН В КОНТЕКСТЕ ЖКХ?
---------------------------------
Использование блокчейна, даже в такой упрощенной форме, может принести
значительные преимущества в сфере ЖКХ, решая проблемы, связанные с:

- Транспарентностью (Прозрачностью): Все платежи записываются в общедоступную
  (или контролируемо-доступную) цепочку блоков, что позволяет жильцам,
  управляющим компаниям и надзорным органам видеть все транзакции без
  возможности их скрытия или изменения. Это создает доверие и сокращает
  количество споров.
- Защитой от подделок и мошенничества: Каждый блок содержит криптографический
  хэш предыдущего блока. Любая попытка изменить запись о платеже в прошлом
  блоке приведет к изменению его хэша, что, в свою очередь, нарушит
  целостность всей последующей цепочки блоков. Это делает подделку данных
  практически невозможной и легко обнаруживаемой.
- Неизменяемым логом платежей (Аудируемостью): Блокчейн служит постоянным,
  хронологическим и неизменяемым реестром всех финансовых операций. Это
  упрощает аудит, отчётность и разрешение любых разногласий по платежам,
  поскольку всегда есть однозначная и надёжная запись.

---

3. ОСНОВНЫЕ ВОЗМОЖНОСТИ
----------------------
- Имитация платежей: Пользователи могут отправлять платежи за различные
  коммунальные услуги (вода, электричество и т.д.).
- Накопление платежей: Платежи сначала накапливаются в "пуле" ожидающих
  транзакций.
- Формирование блоков: При достижении определенного лимита (по умолчанию
  3 платежа) создается новый блок, содержащий накопленные платежи.
- Цепочка блоков: Каждый новый блок связывается с предыдущим с помощью
  криптографического хэша, формируя неизменяемую цепочку.
- Прозрачность: Возможность просмотра всей цепочки блоков через REST API.
- Проверка целостности: Эндпоинт для проверки, не была ли цепочка изменена.

---

4. ТЕХНОЛОГИИ И СТЕК
-------------------
- Spring Boot 3.x: Фреймворк для быстрого создания Java-приложений.
- Java 17+: Язык программирования.
- Lombok: Библиотека для сокращения бойлерплейт-кода (геттеры, сеттеры,
  конструкторы).
- Maven: Инструмент для управления проектом и сборки.
- Jackson: (Включен в Spring Boot Web) Для сериализации/десериализации JSON.
- In-Memory Storage: Все данные хранятся в оперативной памяти и теряются
  при перезапуске приложения.
- SHA-256: Простейший алгоритм хеширования для создания уникальных
  "отпечатков" блоков.

---

5. СТРУКТУРА ПРОЕКТА
-------------------
Проект организован в соответствии со стандартной структурой Spring Boot
приложения:

blockchain-tax/
|-- pom.xml
`-- src/
    `-- main/
`-- java/
    `-- com/
`-- example/
    `-- blockchain/
`-- tax/
    |-- BlockchainTaxApplication.java  # Точка входа в приложение
    |-- controller/
    |   `-- BlockchainController.java  # REST API контроллер
|-- model/
|   |-- Block.java                 # Модель блока
|   |-- Payment.java               # Модель платежа
|   `-- PaymentRequest.java        # DTO для входящих платежей
                            |-- service/
                            |   `-- BlockchainService.java     # Сервис, содержащий бизнес-логику блокчейна
`-- util/
    `-- HashingUtil.java           # Утилита для SHA-256 хеширования

Краткое описание компонентов:
- BlockchainTaxApplication.java: Основной класс, запускающий Spring Boot
  приложение.
- model/: Определяет структуры данных, используемые в блокчейне: Payment
  (отдельный платёж), Block (блок, содержащий платежи и хэши), PaymentRequest
  (формат данных для получения платежа через API).
- util/HashingUtil.java: Статический метод для вычисления SHA-256 хэшей,
  используемый для связывания блоков.
- service/BlockchainService.java: Центральная часть логики. Управляет
  цепочкой блоков, добавляет платежи, "майнит" (создает) новые блоки, когда
  накапливается достаточно платежей, и предоставляет методы для просмотра
  и проверки цепочки.
- controller/BlockchainController.java: Предоставляет RESTful API для
  взаимодействия с сервисом блокчейна, позволяя отправлять платежи и
  получать информацию о блокчейне.

---

6. НАЧАЛО РАБОТЫ
---------------

Необходимые Условия:
- Java Development Kit (JDK) 17 или выше.
- Apache Maven 3.6 или выше.
- Любой HTTP-клиент для тестирования API (например, curl, Postman, Insomnia,
  VS Code REST Client).
- (Опционально для красивого вывода JSON в терминале) jq или json_pp (Perl
  JSON Prettifier).

Сборка и Запуск:
1. Создайте структуру проекта:
    - Создайте корневую папку для проекта, например, blockchain-tax-demo.
    - Поместите файл pom.xml в эту корневую папку.
    - Создайте подпапки src/main/java/com/example/blockchain/tax/ и в них
      model, util, service, controller.
    - Скопируйте соответствующие .java файлы в эти папки.

2. Перейдите в корневую директорию проекта в терминале.

3. Соберите проект с помощью Maven:
   mvn clean install

4. Запустите Spring Boot приложение:
   mvn spring-boot:run
   Или напрямую из JAR-файла:
   java -jar target/blockchain-tax-0.0.1-SNAPSHOT.jar

   Приложение запустится на порту 8080 (по умолчанию). Вы увидите логи
   в консоли, включая сообщение о создании "Генезис-блока".

---

7. API ЭНДПОИНТЫ
---------------

Приложение предоставляет следующие RESTful API:

* POST /api/blockchain/payment
  Описание: Отправляет новый платеж для включения в блокчейн. Платежи
  сначала добавляются в пул ожидающих транзакций. Когда их
  количество достигнет лимита (по умолчанию 3 платежа),
  будет создан новый блок.
  Тело запроса (JSON):
  {
  "userId": "string",
  "amount": 0.00,
  "serviceType": "string"
  }
  Пример использования curl:
  curl -X POST -H "Content-Type: application/json" -d '{"userId": "user101", "amount": 250.75, "serviceType": "Internet"}' http://localhost:8080/api/blockchain/payment


* GET /api/blockchain/chain
  Описание: Возвращает всю текущую цепочку блоков, включая генезис-блок
  и все последующие блоки с их платежами.
  Пример использования curl:
  curl -X GET http://localhost:8080/api/blockchain/chain


* GET /api/blockchain/pending-payments
  Описание: Возвращает список платежей, которые были отправлены, но еще
  не были включены ни в один блок.
  Пример использования curl:
  curl -X GET http://localhost:8080/api/blockchain/pending-payments


* GET /api/blockchain/is-valid
  Описание: Проверяет целостность цепочки блоков. Если какой-либо блок
  был изменен, или ссылки на предыдущие хэши нарушены, метод
  вернет ошибку.
  Пример использования curl:
  curl -X GET http://localhost:8080/api/blockchain/is-valid

---

8. ПОШАГОВОЕ ИСПОЛЬЗОВАНИЕ
-------------------------

После запуска приложения выполните следующие шаги для демонстрации работы
блокчейна. Рекомендуется использовать curl в терминале, а для более
читаемого вывода JSON можно добавить "| json_pp" (если установлен) или
"| jq ." (если установлен jq) в конце команд curl.

1. Проверьте исходное состояние цепочки:
   Когда приложение запустится, оно автоматически создаст "Генезис-блок".
   Откройте http://localhost:8080/api/blockchain/chain в браузере или
   используйте curl:
   curl -X GET http://localhost:8080/api/blockchain/chain | json_pp

   Вы увидите один блок в массиве JSON. Это Генезис-блок (index: 0,
   previousHash: "0", пустой список платежей).

2. Отправьте первый платеж:
   curl -X POST -H "Content-Type: application/json" -d '{"userId": "user101", "amount": 250.75, "serviceType": "Internet"}' http://localhost:8080/api/blockchain/payment

   В консоли Spring Boot приложения вы увидите сообщение
   "Payment added to pending: [ID платежа] by user101".

3. Отправьте второй платеж:
   curl -X POST -H "Content-Type: application/json" -d '{"userId": "user102", "amount": 1200.00, "serviceType": "Electricity"}' http://localhost:8080/api/blockchain/payment

   Снова сообщение о добавлении в pending.

4. Проверьте ожидающие платежи:
   curl -X GET http://localhost:8080/api/blockchain/pending-payments | json_pp

   Вы увидите в ответе JSON-массив, содержащий два платежа, которые
   ожидают включения в блок.

5. Отправьте третий платеж (который "майнит" новый блок):
   curl -X POST -H "Content-Type: application/json" -d '{"userId": "user103", "amount": 500.00, "serviceType": "Water"}' http://localhost:8080/api/blockchain/payment

   Важно: После этого запроса в консоли Spring Boot приложения вы увидите
   сообщение, похожее на "New Block #1 mined with 3 payments. Hash:
   [хэш_блока]". Это происходит потому, что количество ожидающих платежей
   достигло установленного лимита (3), и BlockchainService автоматически
   создал новый блок.

6. Проверьте обновленную цепочку блоков:
   curl -X GET http://localhost:8080/api/blockchain/chain | json_pp

   Теперь вы увидите в JSON-ответе два блока:
    - Блок 0 (Генезис-блок): Первый блок.
    - Блок 1: Новый блок, который содержит три только что отправленных платежа.
      Обратите внимание, что его поле previousHash будет совпадать с полем
      hash Генезис-блока.

7. Проверьте целостность цепочки:
   curl -X GET http://localhost:8080/api/blockchain/is-valid

   Ответ должен быть "Blockchain is valid!". Это означает, что все хэши
   блоков и ссылки на предыдущие хэши корректны.

8. Попробуйте отправить еще один платеж:
   curl -X POST -H "Content-Type: application/json" -d '{"userId": "user104", "amount": 750.00, "serviceType": "Gas"}' http://localhost:8080/api/blockchain/payment

   Он снова попадет в pending-payments, ожидая, пока накопится достаточное
   количество платежей для следующего блока. Вы можете повторить шаги 2-5,
   чтобы создать новые блоки.
